<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div id="holder" style="display: none;"></div>

    <template id="job_template">
        <div class="person">
            <div class="name">
                <h1 v="textContent-name">John Doe</h1>
            </div>
            <div class="age" v="textContent-age">
                30
            </div>
            <div class="job">
                Developer
            </div>
            
            <div class="salary" v="textContent-salary">
                $100,000
            </div>
            <ol>
                <li>laundry</li>
                <li>flowers</li>
                <li>cookies</li>
            </ol>
            <button onclick="this.parentNode.style.color = 'red'">click me</button>
        </div>
    </template>

    <template id="person_template">
        <div class="person">
            <div v="textContent-name" subscription="none"></div>
            <div v="textContent-age" subscription="none"></div>
            <button class="x" onclick="this.parentNode.remove()">remove</button>
        </div>
    </template>

    <main id="main"></main>

<script>
    function subscribe_component_to_data(template, props) {
        const template_copy = document.importNode(template.content, true);
        const allvs = template_copy.querySelectorAll("[v]");
        allvs.forEach(vItem => {
            const [where, what] = vItem.getAttribute("v").split("-");
            vItem[where] = props[what];
        });

        if ('subscription-key' in props) {
            template_copy.firstElementChild.setAttribute("subscription-key", props['subscription-key']);
            subscriptions[props['subscription-key']] = props;
        }
        // holder.appendChild(template_copy);

        return template_copy;
    }

    function rerender(element, props) {
        const allvs = element.querySelectorAll("[v]");
        allvs.forEach(vItem => {
            const [where, what] = vItem.getAttribute("v").split("-");
            vItem[where] = props[what];
        });
    }

    function rerender_from_subscription(element) {
        const props = subscriptions[element.getAttribute('subscription-key')];
        if (props) {
            rerender(element, props)
        }
    }

    function change_values(element, props) {
        console.log('in change_values', {props})
        const allvs = element.querySelectorAll("[v]");
        allvs.forEach(vItem => {
            const [where, what] = vItem.getAttribute("v").split("-");
            if (what in props) {
                vItem[where] = props[what];
            }
        });
    }

    //the theme is where a bunch of elements can subscribe the a piece of data so that when that data updates so do all the elements attatched too

    function update_data_and_subscribers_with_key(subscription_key, key, new_data){
        const data = subscriptions[subscription_key];
        console.log(data)
        const subscribed_elements = document.querySelectorAll(`[subscription-key=${subscription_key}]`);
        data[key] = new_data;
        const props = {[key]: new_data}
        console.log({props})
        //still in the works as 'props' refelects the name that the change_values function will use to represent it
        subscribed_elements.forEach(element => {
            change_values(element, props);
        })
    }

    function update_data_and_subscribers(data, key, new_data){
        const subscription_key = data['subscription-key'];
        console.log(data)
        const subscribed_elements = document.querySelectorAll(`[subscription-key=${subscription_key}]`);
        data[key] = new_data;
        const props = {[key]: new_data}
        console.log({props})
        //still in the works as 'props' refelects the name that the change_values function will use to represent it
        subscribed_elements.forEach(element => {
            change_values(element, props);
        })
    }
    
    const subscriptions = {};

    const people = [
        {name: 'John', age: 42, "subscription-key": "kerry"},
        {name: 'jp', age: 13, "subscription-key": "jon"},
        {name: 'brad', age: 32, "subscription-key": "dufe"},
        {name: 'gt', age: 56, "subscription-key": "lego"},
    ];




    //high level abstraction
    function get_family_subscribtion(element_householde_leader, data_householde_leader, template){
        console.log(main)
        console.log(people)
        
        data_householde_leader.forEach(data => {
            const pi = subscribe_component_to_data(template, data);
            element_householde_leader.appendChild(pi);
});


}
get_family_subscribtion(main, people, person_template)
</script>
</body>
</html>
